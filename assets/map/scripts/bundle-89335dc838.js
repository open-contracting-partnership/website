!function e(t,a,r){function n(s,i){if(!a[s]){if(!t[s]){var o="function"==typeof require&&require;if(!i&&o)return o(s,!0);if(l)return l(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=a[s]={exports:{}};t[s][0].call(u.exports,function(e){var a=t[s][1][e];return n(a?a:e)},u,u.exports,e,t,a,r)}return a[s].exports}for(var l="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({"/Users/beneverard/Sites/oc-map/app/assets/scripts/components/filter.js":[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("react"),l=r(n),s=l["default"].createClass({displayName:"Filter",propTypes:{className:l["default"].PropTypes.string,children:l["default"].PropTypes.node},getDefaultProps:function(){return{element:"div",className:""}},render:function(){var e=["drop"];return this.props.className&&e.push(this.props.className),l["default"].createElement(this.props.element,{className:e.join(" "),"data-hook":"dropdown",ref:"dropdown"},this.props.children)}});t.exports=s},{react:"react"}],"/Users/beneverard/Sites/oc-map/app/assets/scripts/main.js":[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}e("babel-polyfill");var n=e("react"),l=r(n),s=e("react-dom"),i=e("./views/map-widget"),o=r(i),c=e("./views/table-widget"),u=r(c);window.OC_MAP={initMapWidget:function(e){(0,s.render)(l["default"].createElement(o["default"],null),e)},initTableWidget:function(e){(0,s.render)(l["default"].createElement(u["default"],null),e)}}},{"./views/map-widget":"/Users/beneverard/Sites/oc-map/app/assets/scripts/views/map-widget.js","./views/table-widget":"/Users/beneverard/Sites/oc-map/app/assets/scripts/views/table-widget.js","babel-polyfill":"babel-polyfill",react:"react","react-dom":"react-dom"}],"/Users/beneverard/Sites/oc-map/app/assets/scripts/views/map-widget.js":[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("isomorphic-fetch"),l=r(n),s=e("bluebird"),i=r(s),o=e("react"),c=r(o),u=e("leaflet"),d=r(u),f=e("classnames"),p=r(f),m=e("lodash"),h=r(m),y=e("leaflet-omnivore"),g=r(y),_=e("../components/filter"),v=r(_),b="https://raw.githubusercontent.com/open-contracting-partnership/ocp-data/publish/oc-status/_map.json",E="/wp-content/themes/ocp-v1/endpoints/map-scores.php",C="/wp-content/themes/ocp-v1/endpoints/map-slugs.php",w={all:"Everything",ocds:"Using Open Contracting Data Standard",commitments:"Related commitments",contracts:"Innovation in contract monitoring and data use"},S={ocds_implementation:"in implementation",ocds_historic_data:"historic data",ocds_ongoing_data:"ongoing data"},k=c["default"].createClass({displayName:"MapWidget",mapCountryLayer:null,layerStyles:{"default":{color:"#959595",weight:1,opacity:1,fillOpacity:1,fillColor:"#B5B5B5"},nodata:{color:"#E3E3E3",weight:1,opacity:1,fillOpacity:1,fillColor:"#F4F4F4"},hover:{color:"#C7CC48",weight:1,opacity:1,fillOpacity:.5,fillColor:"#C7CC48"},active:{color:"#C7CC48",weight:1,opacity:1,fillOpacity:1,fillColor:"#C7CC48"},lilac:{color:"#6C75E1",weight:1,opacity:1,fillOpacity:1,fillColor:"#6C75E1"},orange:{color:"#FD843D",weight:1,opacity:1,fillOpacity:1,fillColor:"#FD843D"},teal:{color:"#23B2A7",weight:1,opacity:1,fillOpacity:1,fillColor:"#23B2A7"},darkorange:{color:"#FB6045",weight:1,opacity:1,fillOpacity:1,fillColor:"#FB6045"},blue:{color:"#6991F5",weight:1,opacity:1,fillOpacity:1,fillColor:"#6991F5"}},getInitialState:function(){return{fetchedData:!1,fetchingData:!1,mapTopoJSON:null,godiScores:null,godiData:null,godiPlaces:null,activeCountryProperties:null,viewFilter:"all"}},fetchData:function(){var e=this;this.setState({fetchingData:!0}),i["default"].all([(0,l["default"])(b).then(function(e){if(e.status>=400)throw new Error("Bad response");return e.json()}),(0,l["default"])(E).then(function(e){if(e.status>=400)throw new Error("Bad response");return e.json()}),(0,l["default"])(C).then(function(e){if(e.status>=400)throw new Error("Bad response");return e.json()})]).then(function(t){var a=t[0],r=t[1],n=t[2];e.setState({fetchingData:!1,fetchedData:!0,mapTopoJSON:a,godiData:r,godiPlaces:n}),e.setupMap()})},componentDidMount:function(){this.fetchData()},componentDidUpdate:function(){this.mapCountryLayer&&this.setCountriesStyle()},viewFilterClickHandler:function(e,t){t.preventDefault(),this.setState({viewFilter:e})},closeClickHandler:function(e){e.preventDefault(),this.setState({activeCountryProperties:null})},setCountriesStyle:function(){this.mapCountryLayer.eachLayer(this.setCountryStyle)},setCountryStyle:function(e){if((!e.feature.properties.has_data||e.feature.properties.disclosure_oil_mining)&&"none"!=e.feature.properties.disclosure_oil_mining)return void e.setStyle(this.layerStyles.nodata);if(e.feature.properties.iso_a2===h["default"].get(this.state.activeCountryProperties,"iso_a2",""))return void e.setStyle(this.layerStyles.active);e.setStyle(this.layerStyles["default"]);var t=e.feature.properties;switch(this.state.viewFilter){case"ocds":h["default"].find(t.publishers,{ocds_ongoing_data:!0})?e.setStyle(this.layerStyles.lilac):h["default"].find(t.publishers,{ocds_historic_data:!0})?e.setStyle(this.layerStyles.orange):h["default"].find(t.publishers,{ocds_implementation:!0})&&e.setStyle(this.layerStyles.teal);break;case"commitments":t.ogp_commitments&&t.ogp_commitments.length&&e.setStyle(this.layerStyles.darkorange);break;case"contracts":t.innovations&&t.innovations.length&&e.setStyle(this.layerStyles.blue)}},onEachLayer:function(e){var t=this;this.setCountryStyle(e),e.feature.properties.disclosure_oil_mining&&"none"!=e.feature.properties.disclosure_oil_mining||e.on("click",function(a){e.feature.properties.has_data&&t.setState({activeCountryProperties:a.target.feature.properties})}).on("mousemove",function(a){e.feature.properties.has_data&&a.target.feature.properties.iso_a2!==h["default"].get(t.state.activeCountryProperties,"iso_a2","")&&a.target.setStyle(t.layerStyles.hover)}).on("mouseout",function(a){e.feature.properties.has_data&&a.target.feature.properties.iso_a2!==h["default"].get(t.state.activeCountryProperties,"iso_a2","")&&t.setCountryStyle(a.target)})},setupMap:function(){var e=d["default"].map(this.refs.mapHolder,{scrollWheelZoom:!1}).setView([51.505,-.09],2);this.mapCountryLayer=g["default"].topojson.parse(this.state.mapTopoJSON).eachLayer(this.onEachLayer).addTo(e)},renderGodi:function(e){var t=this.state.godiData,a=null,r=this.state.godiPlaces,n=null;if(a=h["default"].find(t,{place:e.iso_a2.toLowerCase(),dataset:"procurement"}),n=h["default"].find(r,{id:e.iso_a2.toLowerCase()}),a&&n)return c["default"].createElement("p",{className:"godi"},"Transparency of Tenders & Awards: ",c["default"].createElement("a",{href:"http://index.okfn.org/place/"+n.slug,target:"_blank"},a.score,"%"))},renderPublisher:function(e){if(!e.length)return c["default"].createElement("div",null,c["default"].createElement("h3",null,"Using Open Contracting Data Standard"),c["default"].createElement("p",null,"No entity publishing data yet"));var t=h["default"].map(e,function(e,t){var a=[];h["default"].forEach(S,function(t,r){e[r]&&a.push(t)});var r=a.join(", ");return c["default"].createElement("li",{key:t},c["default"].createElement("a",{href:e.publisher_link,target:"_blank"},e.publisher),":",r?c["default"].createElement("span",null," ",r):null)});return c["default"].createElement("div",null,c["default"].createElement("h3",null,"Using Open Contracting Data Standard"),c["default"].createElement("ul",null,t))},renderInnovations:function(e){if(e.length&&!(e[0].innovation_link.length<=1)){var t=h["default"].map(e,function(e,t){return c["default"].createElement("li",{key:t},c["default"].createElement("a",{href:e.innovation_link,target:"_blank"},e.innovation_description))});return c["default"].createElement("div",null,c["default"].createElement("h3",null,"Innovations in contract monitoring and data use"),c["default"].createElement("ul",null,t))}},renderCommitments:function(e){if(e.ogp_commitments.length||e.commitment_oil_mining&&"none"!==e.commitment_oil_mining){var t=h["default"].map(e.ogp_commitments,function(e,t){return c["default"].createElement("li",{key:t},c["default"].createElement("a",{href:e.ogp_commitment_link,target:"_blank"},e.ogp_commitment))});return c["default"].createElement("div",null,c["default"].createElement("h3",null,"Commitments"),c["default"].createElement("ul",null,t))}},renderImpactStories:function(e){if("undefined"!=typeof e.impacts_stories&&e.impacts_stories.length&&!(e.impacts_stories[0].story_url.length<=1)){var t=h["default"].map(e.impacts_stories,function(e,t){return c["default"].createElement("li",{key:t},c["default"].createElement("a",{href:e.story_url,target:"_blank"},e.story_title))});return c["default"].createElement("div",null,c["default"].createElement("h3",null,"Impact stories"),c["default"].createElement("ul",null,t))}},render:function(){var e=this;if(!this.state.fetchedData&&!this.state.fetchingData)return null;var t=this.state.activeCountryProperties;return c["default"].createElement("section",{className:"ocp-map"},c["default"].createElement("header",{className:"ocp-map__header"},c["default"].createElement("h1",{className:"ocp-map__title"},"Open Contracting Map"),c["default"].createElement("div",{className:"ocp-map__actions"},c["default"].createElement(v["default"],{element:"span",className:"drop drop--down drop--align-left"},c["default"].createElement("ul",{className:"drop__menu drop__menu--select"},h["default"].map(w,function(t,a){return c["default"].createElement("li",{key:a},c["default"].createElement("a",{href:"",className:(0,p["default"])("drop__menu-item",{"drop__menu-item--active":e.state.viewFilter===a}),onClick:e.viewFilterClickHandler.bind(null,a)},t))}))))),c["default"].createElement("div",{className:"ocp-map__body"},c["default"].createElement("div",{className:"ocp-map__map",ref:"mapHolder"}),c["default"].createElement("div",{className:(0,p["default"])("ocp-map__content-wrapper",{"ocp-revealed":null!==t})},null!==t?c["default"].createElement("div",{className:"ocp-map__content"},c["default"].createElement("a",{href:"#",className:"ocp-map__button-close",onClick:this.closeClickHandler},c["default"].createElement("span",null,"Close map content")),c["default"].createElement("h2",null,t.name),this.renderPublisher(t.publishers),this.renderInnovations(t.innovations),this.renderCommitments(t),this.renderImpactStories(t),c["default"].createElement("a",{href:"http://survey.open-contracting.org/#/forms/oc-status/"+t.iso_a2.toLowerCase(),target:"_blank",className:(0,p["default"])("ocp-map__content-link","button","button--small")},"Improve the data")):null)))}});t.exports=k},{"../components/filter":"/Users/beneverard/Sites/oc-map/app/assets/scripts/components/filter.js",bluebird:"bluebird",classnames:"classnames","isomorphic-fetch":"isomorphic-fetch",leaflet:"leaflet","leaflet-omnivore":"leaflet-omnivore",lodash:"lodash",react:"react"}],"/Users/beneverard/Sites/oc-map/app/assets/scripts/views/table-widget.js":[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("react"),l=r(n),s=e("isomorphic-fetch"),i=r(s),o=e("lodash"),c=r(o),u=e("classnames"),d=r(u),f=l["default"].createClass({displayName:"TableWidget",getInitialState:function(){return{fetchedData:!1,fetchingData:!1,sort:{field:"country",order:"asc"},data:{}}},fetchData:function(){var e=this;this.setState({fetchingData:!0}),(0,i["default"])("https://raw.githubusercontent.com/open-contracting-partnership/ocp-data/publish/oc-status/_table.json").then(function(e){return e.json()}).then(function(t){e.setState({fetchingData:!1,fetchedData:!0,data:t})})},componentDidMount:function(){this.fetchData()},sortLinkClickHandler:function(e,t){t.preventDefault();var a=this.state.sort,r=a.field,n=a.order,l="asc";r===e&&(l="asc"===n?"desc":"asc"),this.setState({sort:{field:e,order:l}})},renderTableHead:function(){var e=this;return l["default"].createElement("thead",null,l["default"].createElement("tr",null,c["default"].map(this.state.data.meta.display,function(t){var a=(0,d["default"])("sort",{"sort--none":e.state.sort.field!==t.key,"sort--asc":e.state.sort.field===t.key&&"asc"===e.state.sort.order,"sort--desc":e.state.sort.field===t.key&&"desc"===e.state.sort.order});return l["default"].createElement("th",{key:t.key},l["default"].createElement("a",{href:"",className:a,onClick:e.sortLinkClickHandler.bind(null,t.key)},t.value))})))},renderTableBody:function(){var e=this,t=(0,c["default"])(this.state.data.data).sortBy(this.state.sort.field);return"desc"===this.state.sort.order&&(t=t.reverse()),t=t.value(),l["default"].createElement("tbody",null,c["default"].map(t,function(t,a){return l["default"].createElement("tr",{key:"tr-"+a+"-"+c["default"].kebabCase(t.country)},c["default"].map(e.state.data.meta.display,function(e){return l["default"].createElement("td",{key:"tr-"+a+"-td-"+c["default"].kebabCase(e.key)},t[e.key])}))}))},render:function(){return this.state.fetchedData||this.state.fetchingData?l["default"].createElement("section",{className:"ocp-table"},l["default"].createElement("header",{className:"ocp-table__header"},l["default"].createElement("h1",{className:"ocp-table__title"},"Open Contracting Table")),l["default"].createElement("div",{className:"ocp-table__body"},this.state.fetchingData?l["default"].createElement("p",null,"Loading data..."):l["default"].createElement("table",{className:"ocp-table__table"},this.renderTableHead(),this.renderTableBody()))):null}});t.exports=f},{classnames:"classnames","isomorphic-fetch":"isomorphic-fetch",lodash:"lodash",react:"react"}]},{},["/Users/beneverard/Sites/oc-map/app/assets/scripts/main.js"]);